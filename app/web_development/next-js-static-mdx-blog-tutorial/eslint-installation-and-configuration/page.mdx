# ESLint

before we get started here are a few things that are worth knowing:

Next.js has two packages that are related to ESLint:

- [eslint-config-next](https://www.npmjs.com/package/eslint-config-next)
- [eslint-plugin-next](https://www.npmjs.com/package/@next/eslint-plugin-next)

**eslint-config-next** is a package that bundles multiple plugins, it intends to make it easier to get started with ESLint and it will install the following 3 plugins for you:

- [eslint-plugin-react](https://www.npmjs.com/package/eslint-plugin-react)
- [eslint-plugin-react-hooks](https://www.npmjs.com/package/eslint-plugin-react-hooks)
- [eslint-plugin-next](https://www.npmjs.com/package/@next/eslint-plugin-next)

**eslint-plugin-next** is the actual ESLint plugin for Nextjs (called **@next/eslint-plugin-next** on npmjs), it aims to catch common issues and problems in a Nextjs application

for a full list of rules that the ESLint plugin will add check out the [Nextjs "ESLint rules" documentation](https://nextjs.org/docs/app/building-your-application/configuring/eslint#eslint-plugin) or have a look at the [eslint-plugin-next rules directory on github](https://github.com/vercel/next.js/tree/canary/packages/eslint-plugin-next/src/rules)

## installing eslint

Note: you have 4 options when it comes to using ESLint in a Nextjs project, I will quickly go through the 3 first options, spoiler alert I will use option 4 for this project

<details>
<summary><b>option 1:</b> you use [create-next-app](https://www.npmjs.com/package/create-next-app) and when asked about installing eslint you select **YES** to install eslint</summary>

- use the following command `npx create-next-app@latest` to run create-next-app
- when you get asked "Would you like to use ESLint?" choose "YES"
- **create-next-app** will install **eslint-config-next** (as seen above eslint-config-next will install the 3 plugins eslint-plugin-react, eslint-plugin-react-hooks and eslint-plugin-next)
- then create-next-app will create a `.eslintrc.json` file in the root of the project, create-next-app will automatically use the "strict" mode, which means it will **extend** next/core-web-vitals, which is a rule-set containing stricter "core web vitals" rules
- create-next-app will also add the following line `"lint": "next lint"` to your package.json `scripts`, which means if that you now can use the command `npm run lint` it will execute `next lint` which is the Nextjs cli command for linting

</details>

<details>
<summary><b>option 2:</b> you use **create-next-app** but when asked about installing ESLint you select **NO**, but later Nextjs cli linting script `npm run lint` (which will install eslint if it did not get installed yet)</summary>

- use the following command `npx create-next-app@latest` to run create-next-app
- when you get asked "Would you like to use ESLint?" choose "NO"
- even if you choose to NOT install ESLint via create-next-app, it will still add the following line `"lint": "next lint"` to your package.json `scripts`, which means that if you now can use the command `npm run lint` it will execute `next lint` which is the nextjs cli command for linting because it is the first time you run this command and it can't find an eslint configuration file it will suggest you create one
- when using npm run lint, you will get asked if you want to use the **strict** mode (which includes the "core web vitals" rule-set) or the **base** eslint rule-sets, after that **eslint** and **eslint-config-next** will get installed for you
- the script should also create an eslintrc file for you, but currently (16.10.2023) doesn't due to a bug: [Nextjs GitHub issue #55102 (next eslint .eslintrc.json file not being created)](https://github.com/vercel/next.js/issues/55102)

</details>

<details>
<summary><b>option 3:</b> we will NOT use **create-next-app** at all, instead we will manually create an ESLint configuration file and install **eslint-config-next** manually, which will automatically install the 3 plugins (eslint-plugin-react, eslint-plugin-react-hooks and eslint-plugin-next) for us</summary>

- run the following command to install **eslint-config-next** manually `npm i eslint eslint-config-next --save-dev --save-exact`
- now also need to create an `.eslintrc.json` file (if you haven't already created one manually before) in the root of the project
- next, if you wish to use the eslint-config-next **strict** mode (including the "core web vitals" rule-set) add this to your eslint configuration file `"extends": "next/core-web-vitals"` or if you prefer to use the **base** mode add this to your eslint configuration file `"extends": "next"`, make sure the extends for nextjs is always last (after other configurations that you might be have added in your eslint extends)

Note: as mentioned in the [nextjs "configuring ESLint" documentation](https://nextjs.org/docs/pages/building-your-application/configuring/eslint) it is important that **next/core-web-vitals** is last in the list of extended configurations to ensure none of their configurations get overwritten by another configuration that comes after

the package.json will not have a linting command (because we did not use create-next-app), so we need to add the following line `"lint": "next lint"` to our package.json `scripts` to enable linting via the next cli, if we use **next lint** it will lint the default nextjs directories (as of now `ESLINT_DEFAULT_DIRS = ['app', 'pages', 'components', 'lib', 'src']`), but you can manually change that list using the `--dir` flag, to specify which files should get linted you can use the `--file` flag, you can also use the next lint option `--no-cache` to disable caching files into the directory `.next/cache`

</details>

### option 4: we will do a fully manual installation of everything needed to lint both our code and MDX content (we will include **eslint-plugin-next**, but we will NOT use **create-next-app** or the **eslint-config-next** package)

#### create an eslintrc file

first, we configure ESLint using their configuration tool, using this command:

```shell
npm init @eslint/config
```

chose the options you like best, I for my part chose the following:

- how would you like to use eslint: check syntax, find problems and enforce code style
- what type of modules does your project use: javascript (import/export)
- which framework does your project use: react
- does your project use typescript: yes
- where does your project run: press the "a" key to have both selected, "browser" and "node"
- how would you like to define a style for your project: you can select "use a popular style guide" and eslint will let you choose between ["standard"](https://www.npmjs.com/package/eslint-config-standard-with-typescript) and ["XO"](https://www.npmjs.com/package/eslint-config-xo), check out their repositories if you want to know more about what configuration they apply, I for my part prefer to answer some questions to set my own rules and also because in the next step we will extend the next.js ESLint configuration
- what format do you want your config to be in: I like to use javascript configuration files over json as it allows me to leave comments for myself and other developers that might come after me if I wish to do so, so I chose "javascript"
- what style of indentation do you use: I have always used 4 spaces, so I will stick to this, some prefer 2 spaces others prefer tabs these days, there is no right or wrong here, choose what you like best
- what quotes do you use for strings: I always use single quotes, I don't use double quotes in JS and I reserve them for HTML attributes
- what line endings do you use: I chose Windows as I'm on Windows, I don't think it doesn't matter much, because when you commit to GitHub they will get converted anyway, ["for compatibility, line endings are converted to Unix style when you commit files"](https://docs.github.com/en/get-started/getting-started-with-git/configuring-git-to-handle-line-endings#about-line-endings), also if you want to know more about line endings I recommend reading this article ["Dealing with line endings in Windows with Git and ESLint"](https://markoskon.com/line-endings-in-vscode-with-git-and-eslint/)
- do you require semicolons: I don't anymore, less to code is a win for me, but I know it can cause problems as there are some places where they are mandatory, like between statements in a **for loop**, but in all these years finding those few exceptions has not been a problem

now eslint init has created a `.eslintrc.js` configuration file for us

TODOs:
nextjs on build probably uses `next lint` directly (bypassing the command in package.json), so to ensure linting is dune when building, I need to use next.config.mjs to disable linting on build ([nextjs "disable eslint" documentation](https://nextjs.org/docs/pages/api-reference/next-config-js/eslint)), then read the linting to the package.json build script command

nextjs will use its own **next lint** cli directly to lint the code during a build process, it does NOT use the package json lint script, but as we have created a custom package json lint script that does not use next lint, we need to disable linting by nextjs during build by adding the following few lines to our next.config.js like so: 

```mjs
module.exports = {
  eslint: {
    // Warning: This allows production builds to successfully complete even if
    // your project has ESLint errors.
    ignoreDuringBuilds: true,
  },
}
```

now nextjs will not automatically lint during builds, but we still want linting to happen during builds, but using our own package.json lint script, this is why we add `npm run lint` to the package.json build script like so:

```json
"scripts": {
    "dev": "next dev",
    "build": "npm run lint && next build",
    "start": "next start",
    "next-lint": "next lint",
    "lint": "npx eslint ./ --ext .js,.jsx,.ts,.tsx,.mdx,.md --cache --cache-location .next/cache/eslint"
},
```

this will execute our lint script and if there is an error it will stop there, if there is no linting error it will go on and also build the project

because we don't use next lint, the node_modules directory is probably going to be linted, so the node_modules directory needs to get excluded (to check this add .js extension to eslint cli command)
need to tell eslint to use the nextjs cache directory and cache eslint

to enable eslint cache we need to use the option `--cache` (caching is disabled by default) and then we tell eslint to use the same cache directory that next lint would use `--cache-location .next/cache/eslint`

npx eslint ./ --ext .js,.jsx,.ts,.tsx,.mdx,.md --cache-location .next/cache/eslint

- option 4: you don't install **eslint-config-next** at all, but instead you install the 3 plugins manually (eslint-plugin-react, eslint-plugin-react-hooks and eslint-plugin-next) yourself and then manually create an eslint configuration file
  - run the following command to install **eslint-plugin-next** and the other plugins manually `npm i eslint eslint-plugin-react eslint-plugin-react-hooks @next/eslint-plugin-next --save-dev --save-exact`
  - now need to also create an `.eslintrc.json` file in the root of the project and add the recommended rule-sets for each plugin via extends, adding `plugin:react/recommended` will add the recommended rule-set for the eslint-plugin-react, adding `plugin:@next/next/recommended` will add the base rule-set for eslint-plugin-react and adding `plugin:@next/next/core-web-vitals` will additionnally also add some more rules related to "core-web-vitals"

if you plan on having your source files in a directory (other than the project root) then add the following settings to your eslintrc file and replace **src** with the path to your directory (for example "packages/my-app/"):

```mjs
settings: {
    next: {
      rootDir: "src"
    }
  }
```

- if you use this option there is a lot more fine tuning you might want to apply to the eslint configuration file, for example, the eslint-plugin-react recommends you set the `"ecmaFeatures": { "jsx": true }` in the `parserOptions` and in `settings` you should set `"react": { "version": "detect" },` (you can also check in the package.json what react version you are using and set it to that instead of using "detect"), ... I will not further explain every tweak that can be made as this would go far beyond the goals of this tutorial, but I highly recommend you check out the [eslint-plugin-react readme](https://github.com/jsx-eslint/eslint-plugin-react#readme) and [eslint-plugin-react-hooks readme](https://github.com/facebook/react/blob/main/packages/eslint-plugin-react-hooks/README.md) if you want to learn more
- the package.json will not have a linting command (because we did not use create-next-app), so we need to add the following line `"lint": "next lint"` to our package.json `scripts` to enable linting via the next cli, if we use **next lint** it will lint the default nextjs directories (as of now `ESLINT_DEFAULT_DIRS = ['app', 'pages', 'components', 'lib', 'src']`), but you can manually change that list using the `--dir` flag, to specify which files should get linted you can use the `--file` flag, you can also use the next lint option `--no-cache` to discable caching files into the directory `.next/cache`, an alternative if you need more control over the lint command, is to create our linting command using the **eslint cli**, using the command `npx eslint <baseDir> [options]` lets you for example set the `--debug` flag to get a verbose output of what eslint does, the scripts section in your package.json would be something like this `"lint": "next lint"`

Note: option 4 gives you full control over what gets installed, what version of each plugin gets used and you can configure each plugin how you want, but this is also clearly more work (and will probably increase your maintenance costs), so if you don't need to configure every detail of every plugin manually and if you don't use custom overrides then I recommend using one of the first 3 options instead (if you use option 1, 2 or 3 you can still extend add plugins manually or change the eslint configuration at a later point in time)

For this project I will choose option 4, it can be used when creating a new project and works well if you intend to upgrade a project using an older version of nextjs where you already have an eslint configuration file, it also has the benefit (as we will see in the next chapter) that it can be used when you need to create a custom override because as of now next lint will not use the overrides you set in your custom eslint (here is open ticket [next lint command doesn't support overrides #35228](https://github.com/vercel/next.js/issues/35228) for that feature)

read more:

- [nextjs "configuring eslint" documentation](https://nextjs.org/docs/pages/building-your-application/configuring/eslint)

TODO: adding the eslint plugins typescript, jsx-a11y and mdx
TODO: if you want to disable specific rules

### eslint customizing rules

finally, you can now add your own custom rules to the eslint configuration, for example always like to add a custom rule, to ensure all my typescript interfaces start with a big "i", I find this helpful when they get imported later on, to distinguish them from regular functions and variables, if you wish to do so, add the following code in the "rules" section of your `.eslintrc.js`:

```mjs
module.exports = {
rules: {
    '@typescript-eslint/naming-convention': [
        'error',
        {
            'selector': 'interface',
            'format": [
                'PascalCase'
            ],
            'custom': {
                'regex': '^I[A-Z]',
                'match': true
            }
        }
    ],
}
}
```

the completed eslint `.eslintrc.js` configuration file should now look something like this:

```mjs
module.exports = {
    'env': {
        'browser': true,
        'es2021': true,
        'node': true
    },
    'extends': [
        'eslint:recommended',
        'plugin:react/recommended',
        'plugin:@typescript-eslint/recommended',
        'next/core-web-vitals',
    ],
    'overrides': [
    ],
    'parser': '@typescript-eslint/parser',
    'parserOptions': {
        'ecmaVersion': 'latest',
        'sourceType': 'module'
    },
    'plugins': [
        'react',
        '@typescript-eslint'
    ],
    'rules': {
        'indent': [
            'error',
            4,
        ],
        'quotes': [
            'error',
            'single',
        ],
        'semi': [
            'error',
            'never',
        ],
        '@typescript-eslint/naming-convention': [
            'error',
            {
                'selector': 'interface',
                'format': [
                    'PascalCase'
                ],
                'custom': {
                    'regex': '^I[A-Z]',
                    'match': true
                },
            }
        ],
    },
}
```

after setting the custom rule **@typescript-eslint/naming-convention** I got the following error:

> Error while loading rule '@typescript-eslint/naming-convention': You have used a rule which requires parserServices to be generated. You must therefore provide a value for the "parserOptions.project" property for @typescript-eslint/parser.

To fix this (as suggested by the error message) we set the **parserOptions.project** property in our eslintrc file:

```mjs
parserOptions: {
    project: './tsconfig.json'
},
```

but this brings up another problem, the nextjs **eslint-config-next** package we were using already has ESLint "overrides" set up for the typescript files in our project and there is no way to customize that ESLint "overrides", so we need to write our own:

```mjs
overrides: [
        {
            files: ['**/*.ts?(x)'],
            extends: [
                'eslint:recommended',
                'plugin:@typescript-eslint/recommended',
                'plugin:@next/next/recommended',
            ],
            parser: '@typescript-eslint/parser',
            parserOptions: {
                sourceType: 'module',
                ecmaFeatures: {
                    jsx: true,
                },
                warnOnUnsupportedTypeScriptVersion: true,

            },
            rules: {
                // Indentation BUG: https://github.com/eslint/eslint/issues/16385
                /*
                indent: [
                    'error',
                    4,
                ],*/
                quotes: [
                    'error',
                    'single',
                ],
                semi: [
                    'error',
                    'never',
                ],
                '@typescript-eslint/naming-convention': [
                    'error',
                    {
                        'selector': 'interface',
                        'format': [
                            'PascalCase',
                        ],
                        'custom': {
                            'regex': '^I[A-Z]',
                            'match': true,
                        },
                    }
                ],
            },
        },
        {
            files: ['**/*.md?(x)'],
            extends: [
                'plugin:mdx/recommended',
            ],
            parser: 'eslint-mdx',
            parserOptions: {
                markdownExtensions: ['*.md, *.mdx'],
            },

        },
    ],
```
      
now that we have created our overrides for ts(x) files it does not make much sense to keep using the eslint-config-next package, the [nextjs "migrating eslint" documentation](https://nextjs.org/docs/pages/building-your-application/configuring/eslint#migrating-existing-config) mentions that if you customize the parserOptions then just extend the eslint-plugin-next instead of the package eslint-config-next, so that's what we will do now:

TODO: because we are not using **eslint-config-next** besides the eslint overrides there are some things that the config did for us and that we need to add to our setup:

install and configure
eslint-plugin-react
eslint-plugin-react-hooks

### eslint-plugin-mdx

#### installation

Note: I have a chapter about [installing & setting up eslint](#eslint-installation-and-setup) for the project and VSCode, if you skipped that earlier you might want to read it now before adding the eslint mdx plugin

There is an eslint mdx plugin called [eslint-plugin-mdx](https://www.npmjs.com/package/eslint-plugin-mdx) that I recommend installing first, as it will help us write find and fix problems in our mdx content

Note: if you go to the [eslint mdx GitHub repository](https://github.com/mdx-js/eslint-mdx), you will see they have two packages, **eslint-mdx** which is the parser and **eslint-plugin-mdx** which is the actual eslint plugin, you don't need to install the parser manually, so it is in the plugins package json and will be installed when you install the plugin

to install the mdx plugin we use this command:

```shell
npm i eslint-plugin-mdx --save-dev --save-exact
```

#### configuration

when using the MDX eslint plugin we want it to only check mdx files, so as stated in the [eslint-plugin-mdx readme](https://github.com/mdx-js/eslint-mdx#notice) it is very important to use the overrides feature of ESLint, if you want to know more about the parsing issues you might have if not using overrides check out the [eslint-plugin-mdx GitHub issue #251](https://github.com/mdx-js/eslint-mdx/issues/251#issuecomment-736139224)

```json
{
    overrides: [
        {
            files: ['*.mdx'],
            extends: 'plugin:mdx/recommended',
            settings: {
                'mdx/code-blocks': true,
            },
        },
    ],
}
```

read more:

- [eslint documentation: how eslint overrides work](https://eslint.org/docs/latest/use/configure/configuration-files#how-do-overrides-work)

#### remark-lint

##### remark-lint installation

##### remark-lint configuration

Note: after changing values in the remarkrc file, you need to manually restart the eslint server as eslint will NOT automatically detect and reload after you made changes in the remarkrc file

##### restart the eslint server in VSCode

- press `ctrl` + `shift` + `p` to open the command palette
- then enter "ESLint" and choose the command called **ESLint: Restart ESLint Server**

#### adding an eslint test page

### linting your code via the command line

if you now want to lint your code, just run the following command

```shell
npm run lint
```

if you used eslint before you might have used [eslint cli options](https://eslint.org/docs/latest/user-guide/command-line-interface), next lint supports some of these too

which means that if in the past you did, something like this:

```shell
npx eslint ./ --fix
```

then you can still do the same with "next lint", like so:

```shell
npm run lint --fix
```

Note: if you look at the code of linting cli from the next.js package, you can see which eslint options next.js supports ["cli/next-lint.ts"](https://github.com/vercel/next.js/blob/canary/packages/next/src/cli/next-lint.ts#L63)

### linting as you code using ESLint VSCode extensions

there are two VSCode extensions you probably want to install (if your IDE is VSCode), the benefit is that linting will be done in realtime in VSCode as you write your code, if there is a problem it will be underlined and if you hover over the underlined code you will see a tooltip telling you what problem eslint found, this means your code gets linted as you write it and not just when you run the lint command

### VSCode eslint extension

[VSCode eslint extension](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)

to check if eslint is running, press `Ctrl` + `Shift` + `P` to open the command palette, then type **eslint** and choose "ESLint: Show Output Channel", which will open the output channel and show you a message like

{/* lint ignore no-undefined-references */}
> [Info  - 8:41:03 PM] ESLint server is running.

if you see that line it means the ESLint server is running in your workspace

to change the eslint extension settings, click on the "Extensions" icon on the right or press `Ctrl` + `Shift` + `X` and then click on the gear icon (⚙️) and then in the menu select **Extension Settings**

Note: when you edit settings you can do it on a **User** level or **Workspace** level, user level means the settings will get applied to whatever project is open in VSCode (which can be interesting if all your projects are written in the same programming language and you only want to configure extensions for all of them at once), workspace level means the settings will only apply to the current workspace (the currently open project), I like to set the options on a workspace level because this creates a settings.json file inside a **.vscode** directory in the root of my project, I can then commit that directory alongside my project files, so that when someone else does a checkout the will have the settings for VSCode too, but you could also add a note about the settings and what extensions should get installed in your project README for example

this is what my `.vscode/settings.json` looks like for the nextjs / mdx blog:

```json
{
    "eslint.debug": true,
    "eslint.options": {
        "extensions": [
            ".js",
            ".jsx",
            ".md",
            ".mdx",
            ".ts",
            ".tsx"
        ]
    },
    "eslint.validate": [
        "markdown",
        "mdx",
        "javascript",
        "javascriptreact",
        "typescript",
        "typescriptreact"
    ]
}
```

### VSCode language support extension for MDX

Note: I have a chapter about the [VSCode eslint extension](#vscode-eslint-extension), if you skipped it earlier you might want to read it now before adding the VSCode MDX extension

I recommend installing [VSCode language support extension for MDX](https://marketplace.visualstudio.com/items?itemName=unifiedjs.vscode-mdx) when working with MDX content as this extension will add IntelliSense support for MDX files to VSCode

Note: this extension is still experimental, but I had no problems when using it

### disabling eslint rules (remark warnings) using comments

sometimes you might encounter warnings that you want to suppress because it is an exception to the rule (but you don't want to disable the rule completely in your configuration), then you can use comments to disable the rule for example for an entire file or just the next line

#### eslint disable

disabling an eslint rule for the next line (works for plugins too, except remark, see below):

```ts
// eslint-disable-next-line @typescript-eslint/no-unused-vars
const foo = 'bar'
```

read more:

- [eslint "disabling rules using comments" documentation](https://eslint.org/docs/latest/use/configure/rules#disabling-rules)

#### remark lint disable

disabling a remark lint warning for the next line

in markdown files it can be done using html comments:

```md
<!--lint ignore no-undefined-references-->

> [Info  - 8:41:03 PM] ESLint server is running.
```

Note: For HTML comments in markdown files you need to have a blank line between the comment and markdown

in MDX files it can be done using mdx comments:

```mdx
{/* lint ignore no-undefined-references */}
> [Info  - 8:41:03 PM] ESLint server is running.
```

read more:

- [remark lint "ignore warnings" documentation](https://github.com/remarkjs/remark-lint#ignore-warnings)
